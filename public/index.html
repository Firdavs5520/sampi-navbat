<!DOCTYPE html>
<html lang="uz">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sampi Medline Navbat</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Golos+Text:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Golos Text", sans-serif;
        display: flex;
        justify-content: space-evenly;
        align-items: center;
        height: 100vh;
        background: #f5f6fa;
        margin: 0;
      }

      .window {
        background: white;
        border-radius: 20px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        width: 45%;
        text-align: center;
        padding: 20px;
      }

      h1 {
        color: #2f3640;
        margin-bottom: 10px;
        font-size: 28px;
      }

      .number {
        font-size: 180px;
        font-weight: bold;
        color: #273c75;
        margin: 0;
        line-height: 1;
      }

      .hint {
        color: #718093;
        font-size: 20px;
        margin-top: 15px;
        font-weight: 600;
      }

      button {
        margin-top: 15px;
        padding: 10px 20px;
        border: none;
        border-radius: 10px;
        background: #273c75;
        color: white;
        font-size: 16px;
        cursor: pointer;
        transition: background 0.3s;
      }

      button:hover {
        background: #192a56;
      }

      .edit-box {
        display: none;
        margin-top: 10px;
      }

      .edit-box input {
        width: 80px;
        padding: 5px;
        font-size: 16px;
        text-align: center;
      }

      .edit-box button {
        margin-left: 8px;
        padding: 6px 12px;
        font-size: 14px;
      }
    </style>
  </head>

  <body>
    <!-- üîπ LOR-1 oynasi -->
    <div class="window" id="lor1">
      <h1>LOR-1</h1>
      <p>Hozir chiqariladigan navbat:</p>
      <div class="number" id="num1">1</div>
      <p class="hint">Enter tugmasini 1 marta bosing</p>
      <button onclick="toggleEdit('lor1')">‚úèÔ∏è Raqamni o‚Äòzgartirish</button>
      <div class="edit-box" id="edit-lor1">
        <input type="number" id="editInput-lor1" />
        <button onclick="saveEdit('lor1')">Saqlash</button>
      </div>
    </div>

    <!-- üîπ LOR-2 oynasi -->
    <div class="window" id="lor2">
      <h1>LOR-2</h1>
      <p>Hozir chiqariladigan navbat:</p>
      <div class="number" id="num2">1</div>
      <p class="hint">Enter tugmasini 2 marta bosing</p>
      <button onclick="toggleEdit('lor2')">‚úèÔ∏è Raqamni o‚Äòzgartirish</button>
      <div class="edit-box" id="edit-lor2">
        <input type="number" id="editInput-lor2" />
        <button onclick="saveEdit('lor2')">Saqlash</button>
      </div>
    </div>

    <script>
      // üîπ Hozirgi smenani aniqlash
      function getCurrentShift() {
        const hour = new Date().getHours();
        return hour >= 8 && hour < 20 ? "day" : "night";
      }

      // üîπ LOR oynalari uchun navbat funksiyasi
      function setupQueue(lorKey, numberElId, startNum) {
        const numEl = document.getElementById(numberElId);
        const shift = getCurrentShift();
        const storageKey = `${lorKey}-${shift}`;

        // LocalStorage'dan o'qish, agar yo'q bo'lsa startNum dan boshlash
        let current = parseInt(localStorage.getItem(storageKey));
        if (!current || isNaN(current)) {
          current = startNum;
        }
        numEl.textContent = current;

        function openPrint(num) {
          const w = window.open(
            `print.html?num=${num}&lor=${lorKey}`,
            "_blank"
          );
          const check = setInterval(() => {
            if (w.closed) {
              clearInterval(check);
              const status = localStorage.getItem("printStatus");
              if (status === "success") {
                current++;
                localStorage.setItem(storageKey, current);
                numEl.textContent = current;
              }
            }
          }, 400);
        }

        return {
          print: () => openPrint(current),
          setNumber: (newNum) => {
            current = newNum;
            numEl.textContent = current;
            localStorage.setItem(storageKey, current);
            openPrint(current);
          },
        };
      }

      // üîπ Har ikkala LOR uchun sozlama
      const LOR1 = setupQueue("lor1-number", "num1", 1);
      const LOR2 = setupQueue("lor2-number", "num2", 1);

      // üîπ Edit panelni ochish/yopish
      function toggleEdit(lor) {
        const box = document.getElementById(`edit-${lor}`);
        const input = document.getElementById(`editInput-${lor}`);
        box.style.display = box.style.display === "block" ? "none" : "block";
        input.focus();
      }

      // üîπ Raqamni saqlash va chop etish
      function saveEdit(lor) {
        const input = document.getElementById(`editInput-${lor}`);
        const value = parseInt(input.value);
        if (isNaN(value) || value < 1) {
          alert("Raqamni to‚Äòg‚Äòri kiriting!");
          return;
        }
        if (lor === "lor1") {
          LOR1.setNumber(value);
        } else {
          LOR2.setNumber(value);
        }
        document.getElementById(`edit-${lor}`).style.display = "none";
      }

      // üîπ Klaviatura orqali boshqarish
      let enterCount = 0;
      let lastPress = 0;

      document.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          const now = Date.now();

          if (now - lastPress < 500) enterCount++;
          else enterCount = 1;

          lastPress = now;

          clearTimeout(window.enterTimeout);

          window.enterTimeout = setTimeout(() => {
            if (enterCount === 1) {
              LOR1.print(); // üîπ 1 marta Enter ‚Üí LOR-1
            } else if (enterCount === 2) {
              LOR2.print(); // üîπ 2 marta Enter ‚Üí LOR-2
            }
            enterCount = 0;
          }, 400);
        }
      });
    </script>
  </body>
</html>
